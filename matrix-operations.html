<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>R 语言数据分析实战 - 附录 B — 矩阵运算</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./git-github.html" rel="next">
<link href="./notations.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-ZPWJBMKFL8"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-ZPWJBMKFL8', { 'anonymize_ip': true});
</script><script>
MathJax ={
  tex: {
    macros: {
      bm: ["{\\boldsymbol #1}",1],
    }
  }
};
</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="切换侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./notations.html">附录</a></li><li class="breadcrumb-item"><a href="./matrix-operations.html"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">矩阵运算</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="切换侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">R 语言数据分析实战</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/XiangyunHuang/data-analysis-in-action" title="源代码" class="quarto-navigation-tool px-1" aria-label="源代码"><i class="bi bi-github"></i></a>
    <a href="./_main.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="切换深色模式"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">欢迎</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">介绍</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">数据准备</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling-objects.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">数据对象</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling-collection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">数据获取</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling-cleaning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">数据清洗</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling-manipulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">数据操作</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">数据处理</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">数据探索</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">ggplot2 入门</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization-intermediate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">基础图形</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">统计图形</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization-lattice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">lattice 入门</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">graphics 入门</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization-tikz.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">TikZ 入门</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization-practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">探索实践</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">数据交流</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactive-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">交互图形</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactive-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">交互表格</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactive-applications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">交互应用</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./documents-html.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">HTML 文档</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./documents-latex.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">PDF 文档</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./documents-office.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Office 文档</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">统计分析</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./common-statistical-tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">常见的统计检验</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression-and-correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">回归与相关分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./categorical-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">分类数据的分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./power-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">统计检验的功效</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">数据建模</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analyze-network-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">网络数据分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analyze-text-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">文本数据分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analyze-survival-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">生存数据分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analyze-time-series-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">时序数据分析</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">空间分析</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analyze-point-pattern.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">点模式数据分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analyze-spatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">点参考数据分析</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./analyze-areal-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">区域数据分析</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">优化建模</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./statistical-computation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">统计计算</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./numerical-optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">数值优化</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./optimization-problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">优化问题</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">贝叶斯建模</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probabilistic-reasoning-framework.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">概率推理框架</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generalized-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">广义线性模型</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hierarchical-normal-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">分层正态模型</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mixed-effects-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">混合效应模型</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./generalized-additive-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">广义可加模型</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gaussian-processes-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">高斯过程回归</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./time-series-regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">时间序列回归</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">机器学习</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classification-problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">分类问题</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./clustering-problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">聚类问题</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regression-problems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">回归问题</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">参考文献</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
 <span class="menu-text">附录</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true" aria-label="切換部分">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./notations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">数学符号</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matrix-operations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">矩阵运算</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./git-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Git 和 Github</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">目录</h2>
   
  <ul>
<li>
<a href="#sec-basic-matrix-operations" id="toc-sec-basic-matrix-operations" class="nav-link active" data-scroll-target="#sec-basic-matrix-operations"><span class="header-section-number">B.1</span> 基础运算</a>
  <ul class="collapse">
<li><a href="#%E5%8A%A0%E5%87%8F%E4%B9%98" id="toc-加减乘" class="nav-link" data-scroll-target="#%E5%8A%A0%E5%87%8F%E4%B9%98"><span class="header-section-number">B.1.1</span> 加、减、乘</a></li>
  <li><a href="#sec-log-exp" id="toc-sec-log-exp" class="nav-link" data-scroll-target="#sec-log-exp"><span class="header-section-number">B.1.2</span> 对数、指数与幂</a></li>
  <li><a href="#%E8%BF%B9%E7%A7%A9%E6%9D%A1%E4%BB%B6%E6%95%B0" id="toc-迹秩条件数" class="nav-link" data-scroll-target="#%E8%BF%B9%E7%A7%A9%E6%9D%A1%E4%BB%B6%E6%95%B0"><span class="header-section-number">B.1.3</span> 迹、秩、条件数</a></li>
  <li><a href="#%E6%B1%82%E9%80%86%E4%B8%8E%E5%B9%BF%E4%B9%89%E9%80%86" id="toc-求逆与广义逆" class="nav-link" data-scroll-target="#%E6%B1%82%E9%80%86%E4%B8%8E%E5%B9%BF%E4%B9%89%E9%80%86"><span class="header-section-number">B.1.4</span> 求逆与广义逆</a></li>
  <li><a href="#sec-det-adjust" id="toc-sec-det-adjust" class="nav-link" data-scroll-target="#sec-det-adjust"><span class="header-section-number">B.1.5</span> 行列式与伴随</a></li>
  <li><a href="#sec-crossproduct" id="toc-sec-crossproduct" class="nav-link" data-scroll-target="#sec-crossproduct"><span class="header-section-number">B.1.6</span> 外积、直积与交叉积</a></li>
  <li><a href="#subsec-hadamard-product" id="toc-subsec-hadamard-product" class="nav-link" data-scroll-target="#subsec-hadamard-product"><span class="header-section-number">B.1.7</span> Hadamard 积</a></li>
  <li><a href="#subsec-matrix-norm" id="toc-subsec-matrix-norm" class="nav-link" data-scroll-target="#subsec-matrix-norm"><span class="header-section-number">B.1.8</span> 矩阵范数</a></li>
  <li><a href="#sec-transpose-ratate" id="toc-sec-transpose-ratate" class="nav-link" data-scroll-target="#sec-transpose-ratate"><span class="header-section-number">B.1.9</span> 转置与旋转</a></li>
  <li><a href="#sec-orthogonal-projection" id="toc-sec-orthogonal-projection" class="nav-link" data-scroll-target="#sec-orthogonal-projection"><span class="header-section-number">B.1.10</span> 正交与投影</a></li>
  <li><a href="#sec-matrix-givens" id="toc-sec-matrix-givens" class="nav-link" data-scroll-target="#sec-matrix-givens"><span class="header-section-number">B.1.11</span> Givens 变换(*)</a></li>
  <li><a href="#sec-matrix-householder" id="toc-sec-matrix-householder" class="nav-link" data-scroll-target="#sec-matrix-householder"><span class="header-section-number">B.1.12</span> Householder 变换(*)</a></li>
  <li><a href="#sec-identity-matrix" id="toc-sec-identity-matrix" class="nav-link" data-scroll-target="#sec-identity-matrix"><span class="header-section-number">B.1.13</span> 单位矩阵</a></li>
  <li><a href="#sec-matrix-diagonals" id="toc-sec-matrix-diagonals" class="nav-link" data-scroll-target="#sec-matrix-diagonals"><span class="header-section-number">B.1.14</span> 对角矩阵</a></li>
  <li><a href="#sec-sparse-matrix" id="toc-sec-sparse-matrix" class="nav-link" data-scroll-target="#sec-sparse-matrix"><span class="header-section-number">B.1.15</span> 稀疏矩阵</a></li>
  <li><a href="#sec-upper-matrix" id="toc-sec-upper-matrix" class="nav-link" data-scroll-target="#sec-upper-matrix"><span class="header-section-number">B.1.16</span> 上、下三角矩阵</a></li>
  </ul>
</li>
  <li>
<a href="#sec-matrix-decomposition" id="toc-sec-matrix-decomposition" class="nav-link" data-scroll-target="#sec-matrix-decomposition"><span class="header-section-number">B.2</span> 矩阵分解</a>
  <ul class="collapse">
<li><a href="#sec-lu" id="toc-sec-lu" class="nav-link" data-scroll-target="#sec-lu"><span class="header-section-number">B.2.1</span> LU 分解</a></li>
  <li><a href="#sec-schur" id="toc-sec-schur" class="nav-link" data-scroll-target="#sec-schur"><span class="header-section-number">B.2.2</span> Schur 分解</a></li>
  <li><a href="#sec-qr" id="toc-sec-qr" class="nav-link" data-scroll-target="#sec-qr"><span class="header-section-number">B.2.3</span> QR 分解</a></li>
  <li><a href="#sec-cholesky" id="toc-sec-cholesky" class="nav-link" data-scroll-target="#sec-cholesky"><span class="header-section-number">B.2.4</span> Cholesky 分解</a></li>
  <li><a href="#sec-spectral" id="toc-sec-spectral" class="nav-link" data-scroll-target="#sec-spectral"><span class="header-section-number">B.2.5</span> 特征值分解</a></li>
  <li><a href="#sec-svd" id="toc-sec-svd" class="nav-link" data-scroll-target="#sec-svd"><span class="header-section-number">B.2.6</span> SVD 分解</a></li>
  </ul>
</li>
  <li><a href="#sec-eigen-library" id="toc-sec-eigen-library" class="nav-link" data-scroll-target="#sec-eigen-library"><span class="header-section-number">B.3</span> Eigen 库</a></li>
  <li><a href="#sec-matrix-linear-regression" id="toc-sec-matrix-linear-regression" class="nav-link" data-scroll-target="#sec-matrix-linear-regression"><span class="header-section-number">B.4</span> 应用</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/XiangyunHuang/data-analysis-in-action/blob/main/matrix-operations.qmd" class="toc-action"><i class="bi bi-github"></i>查看代码</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./notations.html">附录</a></li><li class="breadcrumb-item"><a href="./matrix-operations.html"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">矩阵运算</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-matrix-operations" class="quarto-section-identifier">附录 B — 矩阵运算</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><div class="hidden">
<p><span class="math display">\[
\def\bm#1{{\boldsymbol #1}}
\]</span></p>
</div>
<blockquote class="blockquote">
<p>There’s probably some examples, but there are some examples of people using <code>solve(t(X) %*% W %*% X) %*% W %*% Y</code> to compute regression coefficients, too.</p>
<p>— Thomas Lumley <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</blockquote>
<p>本文主要介绍 Base R 提供的矩阵运算，包括加、减、乘等基础矩阵运算和常用的矩阵分解方法，总结 Base R 、<strong>Matrix</strong> 包和 Eigen 库对应的矩阵运算函数，分别对应基础、进阶和高阶的读者。最后，介绍矩阵运算在线性回归中的应用。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(Matrix)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="sec-basic-matrix-operations" class="level2" data-number="B.1"><h2 data-number="B.1" class="anchored" data-anchor-id="sec-basic-matrix-operations">
<span class="header-section-number">B.1</span> 基础运算</h2>
<p>约定符号</p>
<p><span class="math display">\[
A = \begin{bmatrix}
a_{11} &amp; a_{12}  &amp; a_{13} \\
a_{21} &amp; a_{22}  &amp; a_{23} \\
a_{31} &amp; a_{32}  &amp; a_{33}
\end{bmatrix}
\]</span></p>
<section id="加减乘" class="level3" data-number="B.1.1"><h3 data-number="B.1.1" class="anchored" data-anchor-id="加减乘">
<span class="header-section-number">B.1.1</span> 加、减、乘</h3>
<p>矩阵 <span class="math inline">\(A\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.2</span>, <span class="fl">1.2</span>, <span class="dv">3</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a>A</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  1.0  1.2
[2,]  1.2  3.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">nrow =</span><span class="dv">2</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a>B</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    3
[2,]    2    4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>A <span class="sc">+</span> A <span class="co"># 对应元素相加</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  2.0  2.4
[2,]  2.4  6.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>A <span class="sc">-</span> A <span class="co"># 对应元素相减</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    0    0
[2,]    0    0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>A <span class="sc">%*%</span> A <span class="co"># 矩阵乘法</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]
[1,] 2.44  4.80
[2,] 4.80 10.44</code></pre>
</div>
</div>
</section><section id="sec-log-exp" class="level3" data-number="B.1.2"><h3 data-number="B.1.2" class="anchored" data-anchor-id="sec-log-exp">
<span class="header-section-number">B.1.2</span> 对数、指数与幂</h3>
<p>矩阵 <span class="math inline">\(A\)</span> 的对数 <span class="math inline">\(\log A\)</span> ，就是找一个矩阵 <span class="math inline">\(L\)</span> 使得 <span class="math inline">\(A = \mathrm{e}^L\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>expm<span class="sc">::</span><span class="fu">logm</span>(A)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]      [,2]
[1,] -0.4485660 0.8050907
[2,]  0.8050907 0.8932519</code></pre>
</div>
</div>
<p>矩阵 <span class="math inline">\(A\)</span> 的指数 <span class="math inline">\(\mathrm{e}^{A}\)</span> 的定义</p>
<p><span class="math display">\[
\mathrm{e}^{A} = \sum_{k=1}^{\infty}\frac{A^k}{k!}
\]</span></p>
<p><strong>expm</strong> 包可以计算矩阵的指数、开方、对数等。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>expm<span class="sc">::</span><span class="fu">expm</span>(A)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]     [,2]
[1,]  7.60987 12.93908
[2,] 12.93908 29.17501</code></pre>
</div>
</div>
<p>或者使用奇异值分解 <span class="math inline">\(A = UDV^{\top}\)</span> ，则 <span class="math inline">\(\mathrm{e}^A = U\mathrm{e}^DV^{\top}\)</span> ，其中，D 是对角矩阵。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>(res <span class="ot">&lt;-</span> <span class="fu">svd</span>(A))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$d
[1] 3.5620499 0.4379501

$u
           [,1]       [,2]
[1,] -0.4241554 -0.9055894
[2,] -0.9055894  0.4241554

$v
           [,1]       [,2]
[1,] -0.4241554 -0.9055894
[2,] -0.9055894  0.4241554</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>res<span class="sc">$</span>u <span class="sc">%*%</span> <span class="fu">diag</span>(<span class="fu">exp</span>(res<span class="sc">$</span>d)) <span class="sc">%*%</span> res<span class="sc">$</span>v</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]     [,2]
[1,]  7.60987 12.93908
[2,] 12.93908 29.17501</code></pre>
</div>
</div>
<p>矩阵 <span class="math inline">\(A\)</span> 的 <span class="math inline">\(n\)</span> 次幂 <span class="math inline">\(A^n\)</span> ，利用奇异值分解 <span class="math inline">\(A = UDV^{\top}\)</span></p>
<p><span class="math display">\[
\begin{aligned}
A^n &amp;= A \times A \times \cdots \times A \\
&amp; = UDV^{\top} UDV^{\top} \cdots UDV^{\top}
\end{aligned}
\]</span></p>
<p>计算 <span class="math inline">\(A^3\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>res<span class="sc">$</span>u <span class="sc">%*%</span> (<span class="fu">diag</span>(res<span class="sc">$</span>d)<span class="sc">^</span><span class="dv">3</span>) <span class="sc">%*%</span> res<span class="sc">$</span>v</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       [,1]   [,2]
[1,]  8.200 17.328
[2,] 17.328 37.080</code></pre>
</div>
</div>
</section><section id="迹秩条件数" class="level3" data-number="B.1.3"><h3 data-number="B.1.3" class="anchored" data-anchor-id="迹秩条件数">
<span class="header-section-number">B.1.3</span> 迹、秩、条件数</h3>
<p>矩阵 <span class="math inline">\(A\)</span> 的迹 <span class="math inline">\(\operatorname{tr}(A) = \sum_{i=1}^{n}a_{ii}\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="fu">sum</span>(<span class="fu">diag</span>(A))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="fu">qr</span>(A)<span class="sc">$</span>rank</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">kappa</span>(A)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10.41469</code></pre>
</div>
</div>
</section><section id="求逆与广义逆" class="level3" data-number="B.1.4"><h3 data-number="B.1.4" class="anchored" data-anchor-id="求逆与广义逆">
<span class="header-section-number">B.1.4</span> 求逆与广义逆</h3>
<p>Moore-Penrose Generalized Inverse 摩尔广义逆 <span class="math inline">\(A^-\)</span>。</p>
<p><span class="math display">\[
A^- = (A^{\top}A)^{-1}A
\]</span></p>
<p>如果 A 可逆，则广义逆就是逆。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">solve</span>(A) <span class="co"># 逆</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]
[1,]  1.9230769 -0.7692308
[2,] -0.7692308  0.6410256</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>MASS<span class="sc">::</span><span class="fu">ginv</span>(A) <span class="co"># 广义逆</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]
[1,]  1.9230769 -0.7692308
[2,] -0.7692308  0.6410256</code></pre>
</div>
</div>
</section><section id="sec-det-adjust" class="level3" data-number="B.1.5"><h3 data-number="B.1.5" class="anchored" data-anchor-id="sec-det-adjust">
<span class="header-section-number">B.1.5</span> 行列式与伴随</h3>
<p>矩阵必须是方阵</p>
<p>伴随矩阵 <span class="math inline">\(A*A^{\star} = A^{\star} *A = |A|*I, A^{\star} = |A|*A^{-1}\)</span></p>
<ul>
<li><span class="math inline">\(|A^{\star}| = |A|^{n-1}, A \in \mathbb{R}^{n\times n},n \geq 2\)</span></li>
<li><span class="math inline">\((A^{\star})^{\star} = |A|^{n-2}A, A \in \mathbb{R}^{n\times n},n \geq 2\)</span></li>
<li>
<span class="math inline">\((A^{\star})^{\star}\)</span> A 的 n 次伴随是？</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">det</span>(A)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.56</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">det</span>(A) <span class="sc">*</span> <span class="fu">solve</span>(A)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  3.0 -1.2
[2,] -1.2  1.0</code></pre>
</div>
</div>
</section><section id="sec-crossproduct" class="level3" data-number="B.1.6"><h3 data-number="B.1.6" class="anchored" data-anchor-id="sec-crossproduct">
<span class="header-section-number">B.1.6</span> 外积、直积与交叉积</h3>
<p>通常的矩阵乘法也叫矩阵内积</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>A <span class="sc">%*%</span> B</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  3.4  7.8
[2,]  7.2 15.6</code></pre>
</div>
</div>
<p>外积</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>A <span class="sc">%o%</span> B <span class="co"># outer(A, B, FUN = "*")</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1, 1

     [,1] [,2]
[1,]  1.0  1.2
[2,]  1.2  3.0

, , 2, 1

     [,1] [,2]
[1,]  2.0  2.4
[2,]  2.4  6.0

, , 1, 2

     [,1] [,2]
[1,]  3.0  3.6
[2,]  3.6  9.0

, , 2, 2

     [,1] [,2]
[1,]  4.0  4.8
[2,]  4.8 12.0</code></pre>
</div>
</div>
<p>直积/克罗内克积</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>A <span class="sc">%x%</span> B <span class="co"># kronecker(A, B, FUN = "*")</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4]
[1,]  1.0  3.0  1.2  3.6
[2,]  2.0  4.0  2.4  4.8
[3,]  1.2  3.6  3.0  9.0
[4,]  2.4  4.8  6.0 12.0</code></pre>
</div>
</div>
<p>交叉积 <span class="math inline">\(A^{\top}A\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">crossprod</span>(A, A)  <span class="co">#  t(x) %*% y</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]
[1,] 2.44  4.80
[2,] 4.80 10.44</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">tcrossprod</span>(A, A) <span class="co">#  x %*% t(y)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]
[1,] 2.44  4.80
[2,] 4.80 10.44</code></pre>
</div>
</div>
</section><section id="subsec-hadamard-product" class="level3" data-number="B.1.7"><h3 data-number="B.1.7" class="anchored" data-anchor-id="subsec-hadamard-product">
<span class="header-section-number">B.1.7</span> Hadamard 积</h3>
<p>Hadamard 积（法国数学家 Jacques Hadamard）也叫 Schur 积（德国数学家 Issai Schur ）或 entrywise 积是两个维数相同的矩阵对应元素相乘，特别地，<span class="math inline">\(A^2\)</span> 表示将矩阵 <span class="math inline">\(A\)</span> 的每个元素平方</p>
<p><span class="math display">\[
(A\circ B)_{ij} = (A)_{ij}(B)_{ij}
\]</span></p>
<p><span class="math display">\[
\begin{bmatrix}
a_{11} &amp; a_{12}  &amp; a_{13} \\
a_{21} &amp; a_{22}  &amp; a_{23} \\
a_{31} &amp; a_{32}  &amp; a_{33}
\end{bmatrix}
\circ
\begin{bmatrix}
b_{11} &amp; b_{12}  &amp; b_{13} \\
b_{21} &amp; b_{22}  &amp; b_{23} \\
b_{31} &amp; b_{32}  &amp; b_{33}
\end{bmatrix}
=
\begin{bmatrix}
a_{11}b_{11} &amp; a_{12}b_{12}  &amp; a_{13}b_{13} \\
a_{21}b_{21} &amp; a_{22}b_{22}  &amp; a_{23}b_{23} \\
a_{31}b_{31} &amp; a_{32}b_{32}  &amp; a_{33}b_{33}
\end{bmatrix}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>fastmatrix<span class="sc">::</span><span class="fu">hadamard</span>(A, B)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  1.0  3.6
[2,]  2.4 12.0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a>A<span class="sc">^</span><span class="dv">2</span>     <span class="co"># 每个元素平方 a_ij ^ 2</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,] 1.00 1.44
[2,] 1.44 9.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>A <span class="sc">**</span> A  <span class="co"># 每个元素的幂 a_ij ^ a_ij</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]      [,2]
[1,] 1.000000  1.244565
[2,] 1.244565 27.000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="dv">2</span><span class="sc">^</span>A     <span class="co"># 每个元素的指数 2 ^ a_ij</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]     [,2]
[1,] 2.000000 2.297397
[2,] 2.297397 8.000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="fu">exp</span>(A)  <span class="co"># 每个元素的指数 exp(a_ij)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]      [,2]
[1,] 2.718282  3.320117
[2,] 3.320117 20.085537</code></pre>
</div>
</div>
</section><section id="subsec-matrix-norm" class="level3" data-number="B.1.8"><h3 data-number="B.1.8" class="anchored" data-anchor-id="subsec-matrix-norm">
<span class="header-section-number">B.1.8</span> 矩阵范数</h3>
<p>矩阵的范数，包括 1，2，无穷范数</p>
<dl>
<dt>
<span class="math inline">\(1\)</span>-范数</dt>
<dd>
<p>列和绝对值最大的</p>
</dd>
<dt>
<span class="math inline">\(2\)</span> - 范数</dt>
<dd>
<p>又称谱范数，矩阵最大的奇异值，如果是方阵，就是最大的特征值</p>
</dd>
<dt>
<span class="math inline">\(\infty\)</span> - 范数</dt>
<dd>
<p>行和绝对值最大的</p>
</dd>
<dt>Frobenius - 范数</dt>
<dd>
<p>Euclidean 范数</p>
</dd>
<dt>
<span class="math inline">\(M\)</span> - 范数</dt>
<dd>
<p>矩阵里模最大的元素，矩阵里面的元素可能含有复数，所以取模最大</p>
</dd>
</dl>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="fu">norm</span>(A, <span class="at">type =</span> <span class="st">"1"</span>) <span class="co"># max(abs(colSums(A)))</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="fu">norm</span>(A, <span class="at">type =</span> <span class="st">"I"</span>) <span class="co"># max(abs(rowSums(A)))</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a><span class="fu">norm</span>(A, <span class="at">type =</span> <span class="st">"F"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.588872</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a><span class="fu">norm</span>(A, <span class="at">type =</span> <span class="st">"M"</span>) <span class="co">#</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="fu">norm</span>(A, <span class="at">type =</span> <span class="st">"2"</span>) <span class="co"># max(svd(A)$d)</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.56205</code></pre>
</div>
</div>
</section><section id="sec-transpose-ratate" class="level3" data-number="B.1.9"><h3 data-number="B.1.9" class="anchored" data-anchor-id="sec-transpose-ratate">
<span class="header-section-number">B.1.9</span> 转置与旋转</h3>
<p>矩阵 <span class="math inline">\(A\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="fu">t</span>(A) <span class="co"># 转置</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  1.0  1.2
[2,]  1.2  3.0</code></pre>
</div>
</div>
</section><section id="sec-orthogonal-projection" class="level3" data-number="B.1.10"><h3 data-number="B.1.10" class="anchored" data-anchor-id="sec-orthogonal-projection">
<span class="header-section-number">B.1.10</span> 正交与投影</h3>
<p>矩阵 <span class="math inline">\(A\)</span> 的投影</p>
<p><span class="math display">\[
I - A(A^{\top}A)^{-1}A^{\top}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="fu">diag</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">-</span> A <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(A) <span class="sc">%*%</span> A) <span class="sc">%*%</span> <span class="fu">t</span>(A)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]          [,2]
[1,] -6.661338e-16  3.330669e-16
[2,]  3.837386e-16 -2.220446e-16</code></pre>
</div>
</div>
</section><section id="sec-matrix-givens" class="level3" data-number="B.1.11"><h3 data-number="B.1.11" class="anchored" data-anchor-id="sec-matrix-givens">
<span class="header-section-number">B.1.11</span> Givens 变换(*)</h3>
<ul>
<li><a href="https://www.wikiwand.com/en/Givens_rotation">Givens 旋转</a></li>
<li>帽子矩阵在统计中的应用，回归与方差分析 <span class="citation" data-cites="David1978">(<a href="references.html#ref-David1978" role="doc-biblioref">Hoaglin 和 Welsch 1978</a>)</span>
</li>
</ul></section><section id="sec-matrix-householder" class="level3" data-number="B.1.12"><h3 data-number="B.1.12" class="anchored" data-anchor-id="sec-matrix-householder">
<span class="header-section-number">B.1.12</span> Householder 变换(*)</h3>
<p>Householder 变换是平面反射的一般情况： 要计算 <span class="math inline">\(N\times P\)</span> 维矩阵 <span class="math inline">\(X\)</span> 的 QR 分解，我们采用 Householder 变换</p>
<p><span class="math display">\[
\mathbf{H}_{u} = \mathbf{I} -2\mathbf{u}\mathbf{u}^{\top}
\]</span></p>
<p>其中 <span class="math inline">\(I\)</span> 是 <span class="math inline">\(N\times N\)</span> 维的单位矩阵，<span class="math inline">\(u\)</span> 是 <span class="math inline">\(N\)</span> 维单位向量，即 <span class="math inline">\(\| \mathbf{u}\| = \sqrt{\mathbf{u}\mathbf{u}^{\top}} = 1\)</span>。则 <span class="math inline">\(H_u\)</span> 是对称正交的，因为</p>
<p><span class="math display">\[
\mathbf{H}_{u}^{\top} = \mathbf{I}^{\top} - 2\mathbf{u}\mathbf{u}^{\top} = \mathbf{H}_{u}
\]</span></p>
<p>并且</p>
<p><span class="math display">\[
\mathbf{H}_{u}^{\top}\mathbf{H}_{u} =  \mathbf{I} -4\mathbf{u}\mathbf{u}^{\top} + 4\mathbf{u}\mathbf{u}^{\top}\mathbf{u}\mathbf{u}^{\top} = \mathbf{I}
\]</span></p>
<p>让 <span class="math inline">\(\mathbf{H}_{u}\)</span> 乘以向量 <span class="math inline">\(\mathbf{y}\)</span>，即</p>
<p><span class="math display">\[
\mathbf{H}_{u}\mathbf{y} = \mathbf{y} - 2\mathbf{u}\mathbf{u}^{\top}\mathbf{y}
\]</span></p>
<p>它是 <span class="math inline">\(y\)</span> 关于垂直于过原点的 <span class="math inline">\(u\)</span> 的直线的反射，只要</p>
<p><span id="eq-householder-negative"><span class="math display">\[
\begin{aligned}
\mathbf{u} = \frac{\mathbf{y} - \| \mathbf{y} \|\mathbf{e}_{1}}{\| \mathbf{y} - \| \mathbf{y} \|\mathbf{e}_{1}\|}
\end{aligned}
\tag{B.1}\]</span></span></p>
<p>或者</p>
<p><span id="eq-householder-positive"><span class="math display">\[
\begin{aligned}
\mathbf{u} = \frac{\mathbf{y} + \| \mathbf{y} \|\mathbf{e}_{1}}{\| \mathbf{y} + \| \mathbf{y} \|\mathbf{e}_{1}\|}
\end{aligned}
\tag{B.2}\]</span></span></p>
<p>其中 <span class="math inline">\(\mathbf{e}_{1} = (1,0,\ldots,0)^{\top}\)</span>，Householder 变换使得向量 <span class="math inline">\(y\)</span> 成为 <span class="math inline">\(x\)</span> 轴，在新的坐标系统中，向量 <span class="math inline">\(H_{u}y\)</span> 的坐标为 <span class="math inline">\((\pm\|y\|, 0, \ldots, 0)^\top\)</span></p>
<p>举个例子</p>
<p>借助 Householder 变换做 QR 分解的优势：</p>
<ol type="1">
<li>更快、数值更稳定比直接构造 Q，特别当 N 大于 P 的时候</li>
<li>相比于存储矩阵 Q 的 <span class="math inline">\(N^2\)</span> 个元素，Householder 变换只存储 P 个向量 <span class="math inline">\(u_1,\ldots,u_P\)</span>
</li>
<li>QR 分解的真实实现，比如在 LINPACK 中，定义 <span class="math inline">\(u\)</span> 的时候， <a href="#eq-householder-negative" class="quarto-xref">方程式&nbsp;<span>B.1</span></a> 或 <a href="#eq-householder-positive" class="quarto-xref">方程式&nbsp;<span>B.2</span></a> 的选择基于 <span class="math inline">\(y\)</span> 的第一个坐标的符号。如果坐标是负的，使用 <a href="#eq-householder-negative" class="quarto-xref">方程式&nbsp;<span>B.1</span></a> ，如果是正的，使用 <a href="#eq-householder-positive" class="quarto-xref">方程式&nbsp;<span>B.2</span></a> ， 这个做法可以使得数值计算更加稳定。</li>
</ol>
<p>用 Householder 变换做 QR 分解 <span class="citation" data-cites="Bates1988">(<a href="references.html#ref-Bates1988" role="doc-biblioref">Bates 和 Watts 1988</a>)</span> 及其 <a href="https://rpubs.com/aaronsc32/qr-decomposition-householder">R 语言</a>、Eigen 实现。</p>
</section><section id="sec-identity-matrix" class="level3" data-number="B.1.13"><h3 data-number="B.1.13" class="anchored" data-anchor-id="sec-identity-matrix">
<span class="header-section-number">B.1.13</span> 单位矩阵</h3>
<p>矩阵对角线上全是1，其余位置都是0</p>
<p><span class="math display">\[
A = \begin{bmatrix}
1 &amp; 0  &amp; 0 \\
0 &amp; 1  &amp; 0 \\
0 &amp; 0  &amp; 1
\end{bmatrix}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="fu">diag</span>(<span class="fu">rep</span>(<span class="dv">3</span>))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1</code></pre>
</div>
</div>
<p>而全1矩阵是所有元素都是1的矩阵，可以借助外积运算构造，如3阶全1矩阵</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">3</span>) <span class="sc">%o%</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">3</span>) </span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    1    1
[2,]    1    1    1
[3,]    1    1    1</code></pre>
</div>
</div>
</section><section id="sec-matrix-diagonals" class="level3" data-number="B.1.14"><h3 data-number="B.1.14" class="anchored" data-anchor-id="sec-matrix-diagonals">
<span class="header-section-number">B.1.14</span> 对角矩阵</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="fu">diag</span>(A)       <span class="co"># 矩阵的对角</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="fu">diag</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)) <span class="co"># 构造对角矩阵</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    2    0
[3,]    0    0    3</code></pre>
</div>
</div>
</section><section id="sec-sparse-matrix" class="level3" data-number="B.1.15"><h3 data-number="B.1.15" class="anchored" data-anchor-id="sec-sparse-matrix">
<span class="header-section-number">B.1.15</span> 稀疏矩阵</h3>
<p>稀疏矩阵的典型构造方式是通过三元组。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a>i <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>) <span class="co"># 行指标</span></span>
<span id="cb78-2"><a href="#cb78-2"></a>j <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>) <span class="co"># 列指标</span></span>
<span id="cb78-3"><a href="#cb78-3"></a>x <span class="ot">&lt;-</span> <span class="dv">7</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="co"># 数据</span></span>
<span id="cb78-4"><a href="#cb78-4"></a>Matrix<span class="sc">::</span><span class="fu">sparseMatrix</span>(i, j, <span class="at">x =</span> x)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>8 x 10 sparse Matrix of class "dgCMatrix"
                             
[1,] . 7 . . .  .  .  .  .  .
[2,] . . . . .  .  .  .  .  .
[3,] . . . . .  .  .  . 14  .
[4,] . . . . . 21  .  .  .  .
[5,] . . . . .  . 28  .  .  .
[6,] . . . . .  .  . 35  .  .
[7,] . . . . .  .  .  . 42  .
[8,] . . . . .  .  .  .  . 49</code></pre>
</div>
</div>
</section><section id="sec-upper-matrix" class="level3" data-number="B.1.16"><h3 data-number="B.1.16" class="anchored" data-anchor-id="sec-upper-matrix">
<span class="header-section-number">B.1.16</span> 上、下三角矩阵</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a>m <span class="ot">&lt;-</span> A</span>
<span id="cb80-2"><a href="#cb80-2"></a>m</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  1.0  1.2
[2,]  1.2  3.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="fu">upper.tri</span>(m) <span class="co"># 矩阵上三角</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2]
[1,] FALSE  TRUE
[2,] FALSE FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>m[<span class="fu">upper.tri</span>(m)]</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>m[<span class="fu">lower.tri</span>(m)] <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># 获得上三角矩阵</span></span>
<span id="cb86-2"><a href="#cb86-2"></a>m</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1  1.2
[2,]    0  3.0</code></pre>
</div>
</div>
<p>矩阵 A 的下三角矩阵</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb88-2"><a href="#cb88-2"></a>m[<span class="fu">row</span>(m) <span class="sc">&lt;</span> <span class="fu">col</span>(m)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb88-3"><a href="#cb88-3"></a>m</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    0
[2,]    2    3</code></pre>
</div>
</div>
</section></section><section id="sec-matrix-decomposition" class="level2" data-number="B.2"><h2 data-number="B.2" class="anchored" data-anchor-id="sec-matrix-decomposition">
<span class="header-section-number">B.2</span> 矩阵分解</h2>
<section id="sec-lu" class="level3" data-number="B.2.1"><h3 data-number="B.2.1" class="anchored" data-anchor-id="sec-lu">
<span class="header-section-number">B.2.1</span> LU 分解</h3>
<p>矩阵 <span class="math inline">\(A\)</span> 的 LU 分解 <span class="math inline">\(A = LU\)</span> ， <span class="math inline">\(L\)</span> 是下三角矩阵，<span class="math inline">\(U\)</span> 是上三角矩阵</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a>Matrix<span class="sc">::</span><span class="fu">lu</span>(A)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LU factorization of Formal class 'denseLU' [package "Matrix"] with 4 slots
  ..@ x       : num [1:4] 1.2 0.833 3 -1.3
  ..@ perm    : int [1:2] 2 2
  ..@ Dim     : int [1:2] 2 2
  ..@ Dimnames:List of 2
  .. ..$ : NULL
  .. ..$ : NULL</code></pre>
</div>
</div>
</section><section id="sec-schur" class="level3" data-number="B.2.2"><h3 data-number="B.2.2" class="anchored" data-anchor-id="sec-schur">
<span class="header-section-number">B.2.2</span> Schur 分解</h3>
<p>矩阵 <span class="math inline">\(A\)</span> 的 Schur 分解 <span class="math inline">\(A = QTQ^{\top}\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a>(res <span class="ot">&lt;-</span> Matrix<span class="sc">::</span><span class="fu">Schur</span>(A))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Q
           [,1]       [,2]
[1,] -0.9055894 -0.4241554
[2,]  0.4241554 -0.9055894

$T
          [,1]    [,2]
[1,] 0.4379501 0.00000
[2,] 0.0000000 3.56205

$EValues
[1] 0.4379501 3.5620499</code></pre>
</div>
</div>
<p>其中 <span class="math inline">\(Q\)</span> 是一个正交矩阵 <span class="math inline">\(QQ = I\)</span> ，<span class="math inline">\(T\)</span> 是一个分块上三角矩阵</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a>res<span class="sc">$</span>Q <span class="sc">%*%</span> <span class="fu">t</span>(res<span class="sc">$</span>Q)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]         [,2]
[1,] 1.000000e+00 8.052102e-18
[2,] 8.052102e-18 1.000000e+00</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a>res<span class="sc">$</span>Q <span class="sc">%*%</span> res<span class="sc">$</span>T <span class="sc">%*%</span> <span class="fu">t</span>(res<span class="sc">$</span>Q)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  1.0  1.2
[2,]  1.2  3.0</code></pre>
</div>
</div>
</section><section id="sec-qr" class="level3" data-number="B.2.3"><h3 data-number="B.2.3" class="anchored" data-anchor-id="sec-qr">
<span class="header-section-number">B.2.3</span> QR 分解</h3>
<p>矩阵 <span class="math inline">\(A\)</span> 的 QR 分解 <span class="math inline">\(A = QR\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a>(res <span class="ot">&lt;-</span> <span class="fu">qr</span>(A))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$qr
           [,1]       [,2]
[1,] -1.5620499 -3.0728851
[2,]  0.7682213  0.9986877

$rank
[1] 2

$qraux
[1] 1.6401844 0.9986877

$pivot
[1] 1 2

attr(,"class")
[1] "qr"</code></pre>
</div>
</div>
<p>QR 分解结果中的 Q</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="fu">qr.Q</span>(res)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]
[1,] -0.6401844 -0.7682213
[2,] -0.7682213  0.6401844</code></pre>
</div>
</div>
<p>QR 分解结果中的 R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a><span class="fu">qr.R</span>(res)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         [,1]       [,2]
[1,] -1.56205 -3.0728851
[2,]  0.00000  0.9986877</code></pre>
</div>
</div>
<p>恢复矩阵 <span class="math inline">\(A\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1"></a><span class="fu">qr.Q</span>(res) <span class="sc">%*%</span> <span class="fu">qr.R</span>(res)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  1.0  1.2
[2,]  1.2  3.0</code></pre>
</div>
</div>
</section><section id="sec-cholesky" class="level3" data-number="B.2.4"><h3 data-number="B.2.4" class="anchored" data-anchor-id="sec-cholesky">
<span class="header-section-number">B.2.4</span> Cholesky 分解</h3>
<p>矩阵 <span class="math inline">\(A\)</span> 的 Cholesky 分解 <span class="math inline">\(A = L^{\top}L\)</span> ，其中 <span class="math inline">\(L\)</span> 是上三角矩阵</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1"></a>(res <span class="ot">&lt;-</span> <span class="fu">chol</span>(A))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]
[1,]    1 1.200
[2,]    0 1.249</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1"></a><span class="fu">t</span>(res) <span class="sc">%*%</span> res</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  1.0  1.2
[2,]  1.2  3.0</code></pre>
</div>
</div>
</section><section id="sec-spectral" class="level3" data-number="B.2.5"><h3 data-number="B.2.5" class="anchored" data-anchor-id="sec-spectral">
<span class="header-section-number">B.2.5</span> 特征值分解</h3>
<p>特征值分解（Eigenvalues Decomposition）也叫谱分解（Spectral Decomposition）</p>
<p>矩阵 <span class="math inline">\(A\)</span> 的特征值分解 <span class="math inline">\(A = V\Lambda V^{-1}\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1"></a>(res <span class="ot">&lt;-</span> <span class="fu">eigen</span>(A))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1] 3.5620499 0.4379501

$vectors
          [,1]       [,2]
[1,] 0.4241554 -0.9055894
[2,] 0.9055894  0.4241554</code></pre>
</div>
</div>
<p>返回值列表中的元素 vectors 就是 <span class="math inline">\(V\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1"></a>res<span class="sc">$</span>vectors <span class="sc">%*%</span> <span class="fu">diag</span>(res<span class="sc">$</span>values) <span class="sc">%*%</span> <span class="fu">solve</span>(res<span class="sc">$</span>vectors)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  1.0  1.2
[2,]  1.2  3.0</code></pre>
</div>
</div>
<p>计算特征值，即求解如下一元 <span class="math inline">\(n\)</span> 次方程</p>
<p><span class="math inline">\(|A - \lambda I| = 0\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1"></a>rootSolve<span class="sc">::</span><span class="fu">uniroot.all</span>(</span>
<span id="cb114-2"><a href="#cb114-2"></a>  <span class="at">f =</span> <span class="cf">function</span>(x) (x <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (x <span class="sc">-</span> <span class="dv">3</span>) <span class="sc">-</span> <span class="fl">1.2</span><span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb114-3"><a href="#cb114-3"></a>  <span class="at">lower =</span> <span class="sc">-</span><span class="dv">10</span>, <span class="at">upper =</span> <span class="dv">10</span></span>
<span id="cb114-4"><a href="#cb114-4"></a>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4379747 3.5620253</code></pre>
</div>
</div>
</section><section id="sec-svd" class="level3" data-number="B.2.6"><h3 data-number="B.2.6" class="anchored" data-anchor-id="sec-svd">
<span class="header-section-number">B.2.6</span> SVD 分解</h3>
<p>矩阵 <span class="math inline">\(A\)</span> 的 SVD 分解 <span class="math inline">\(A = UDV^{\top}\)</span> ，矩阵 U 和 V 是正交的，矩阵 D 是对角的，矩阵 D 的对角元素是按降序排列的奇异值。</p>
<p>当矩阵是对称矩阵时，SVD 分解和特征值分解结果是一样的。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1"></a>(res <span class="ot">&lt;-</span> <span class="fu">svd</span>(A))</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$d
[1] 3.5620499 0.4379501

$u
           [,1]       [,2]
[1,] -0.4241554 -0.9055894
[2,] -0.9055894  0.4241554

$v
           [,1]       [,2]
[1,] -0.4241554 -0.9055894
[2,] -0.9055894  0.4241554</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1"></a><span class="co"># A = U D V'</span></span>
<span id="cb118-2"><a href="#cb118-2"></a>res<span class="sc">$</span>u <span class="sc">%*%</span> <span class="fu">diag</span>(res<span class="sc">$</span>d) <span class="sc">%*%</span> <span class="fu">t</span>(res<span class="sc">$</span>v)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  1.0  1.2
[2,]  1.2  3.0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1"></a><span class="co"># D = U'AV</span></span>
<span id="cb120-2"><a href="#cb120-2"></a><span class="fu">t</span>(res<span class="sc">$</span>u) <span class="sc">%*%</span> A <span class="sc">%*%</span> res<span class="sc">$</span>v</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]          [,2]
[1,] 3.562050e+00 -3.276838e-16
[2,] 3.602566e-17  4.379501e-01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1"></a><span class="co"># I = VV'</span></span>
<span id="cb122-2"><a href="#cb122-2"></a>res<span class="sc">$</span>v <span class="sc">%*%</span> <span class="fu">t</span>(res<span class="sc">$</span>v)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]          [,2]
[1,]  1.000000e+00 -1.647255e-17
[2,] -1.647255e-17  1.000000e+00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1"></a><span class="co"># I = UU'</span></span>
<span id="cb124-2"><a href="#cb124-2"></a>res<span class="sc">$</span>u <span class="sc">%*%</span> <span class="fu">t</span>(res<span class="sc">$</span>u)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]          [,2]
[1,]  1.000000e+00 -7.722454e-17
[2,] -7.722454e-17  1.000000e+00</code></pre>
</div>
</div>
</section></section><section id="sec-eigen-library" class="level2" data-number="B.3"><h2 data-number="B.3" class="anchored" data-anchor-id="sec-eigen-library">
<span class="header-section-number">B.3</span> Eigen 库</h2>
<p>Eigen 是一个高性能的线性代数计算库，基于 C++ 编写，有 R 语言接口 <strong>RcppEigen</strong> 包。示例来自 <strong>RcppEigen</strong> 包，本文增加了特征向量，下面介绍如何借助 <strong>RcppEigen</strong> 包调用 Eigen 库做 SVD 矩阵分解。</p>
<div class="sourceCode" id="rcpp-eigen"><pre class="sourceCode numberSource cpp number-lines code-with-copy"><code class="sourceCode cpp"><span id="rcpp-eigen-1"><a href="#rcpp-eigen-1"></a><span class="pp">#include </span><span class="im">&lt;RcppEigen.h&gt;</span></span>
<span id="rcpp-eigen-2"><a href="#rcpp-eigen-2"></a></span>
<span id="rcpp-eigen-3"><a href="#rcpp-eigen-3"></a><span class="co">// [[Rcpp::depends(RcppEigen)]]</span></span>
<span id="rcpp-eigen-4"><a href="#rcpp-eigen-4"></a></span>
<span id="rcpp-eigen-5"><a href="#rcpp-eigen-5"></a><span class="kw">using</span> Eigen<span class="op">::</span>Map<span class="op">;</span>                       <span class="co">// 'maps' rather than copies</span></span>
<span id="rcpp-eigen-6"><a href="#rcpp-eigen-6"></a><span class="kw">using</span> Eigen<span class="op">::</span>MatrixXd<span class="op">;</span>                  <span class="co">// variable size matrix, double precision</span></span>
<span id="rcpp-eigen-7"><a href="#rcpp-eigen-7"></a><span class="kw">using</span> Eigen<span class="op">::</span>VectorXd<span class="op">;</span>                  <span class="co">// variable size vector, double precision</span></span>
<span id="rcpp-eigen-8"><a href="#rcpp-eigen-8"></a><span class="kw">using</span> Eigen<span class="op">::</span>SelfAdjointEigenSolver<span class="op">;</span>    <span class="co">// one of the eigenvalue solvers</span></span>
<span id="rcpp-eigen-9"><a href="#rcpp-eigen-9"></a></span>
<span id="rcpp-eigen-10"><a href="#rcpp-eigen-10"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="rcpp-eigen-11"><a href="#rcpp-eigen-11"></a>VectorXd getEigenValues<span class="op">(</span>Map<span class="op">&lt;</span>MatrixXd<span class="op">&gt;</span> M<span class="op">)</span> <span class="op">{</span></span>
<span id="rcpp-eigen-12"><a href="#rcpp-eigen-12"></a>  SelfAdjointEigenSolver<span class="op">&lt;</span>MatrixXd<span class="op">&gt;</span> es<span class="op">(</span>M<span class="op">);</span></span>
<span id="rcpp-eigen-13"><a href="#rcpp-eigen-13"></a>  <span class="cf">return</span> es<span class="op">.</span>eigenvalues<span class="op">();</span></span>
<span id="rcpp-eigen-14"><a href="#rcpp-eigen-14"></a><span class="op">}</span></span>
<span id="rcpp-eigen-15"><a href="#rcpp-eigen-15"></a><span class="co">// [[Rcpp::export]]</span></span>
<span id="rcpp-eigen-16"><a href="#rcpp-eigen-16"></a>MatrixXd getEigenVectors<span class="op">(</span>Map<span class="op">&lt;</span>MatrixXd<span class="op">&gt;</span> M<span class="op">)</span> <span class="op">{</span></span>
<span id="rcpp-eigen-17"><a href="#rcpp-eigen-17"></a>  SelfAdjointEigenSolver<span class="op">&lt;</span>MatrixXd<span class="op">&gt;</span> es<span class="op">(</span>M<span class="op">);</span></span>
<span id="rcpp-eigen-18"><a href="#rcpp-eigen-18"></a>  <span class="cf">return</span> es<span class="op">.</span>eigenvectors<span class="op">();</span></span>
<span id="rcpp-eigen-19"><a href="#rcpp-eigen-19"></a><span class="op">}</span></span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>对上面的代码做几点说明：</p>
<ol type="1">
<li>
<code>// [[Rcpp::depends(RcppEigen)]]</code> 可以看作一种标记，表示依赖 <strong>RcppEigen</strong> 包提供的 C++ 头文件，并导入到 C++ 命名空间中。<code>// [[Rcpp::export]]</code> 也可以看作一种标记，表示下面的函数需要导出到 R 语言环境中，这样 C++ 中定义的函数可以在 R 语言环境中使用。</li>
<li>
<code>MatrixXd</code> 和 <code>VectorXd</code> 分别是 Eigen 库中定义的可变大小的双精度矩阵、向量类型。</li>
<li>
<code>SelfAdjointEigenSolver</code> 是 Eigen 库中关于特征值分解方法中的一个求解器，特征值分解的结果有两个部分：一个是由特征值构成的向量，一个是特征向量构成的矩阵。求解器 <code>SelfAdjointEigenSolver</code> 名称中 <code>SelfAdjoint</code> 是伴随的意思，它是做矩阵 <span class="math inline">\(A\)</span> 的伴随矩阵 <span class="math inline">\(A^{\star}\)</span> 的特征值分解。</li>
<li>
<code>getEigenValues</code> 和 <code>getEigenVectors</code> 是用户自定义的两个函数名称，分别计算特征值和特征向量。</li>
</ol>
<p>伴随矩阵的特征值分解和原矩阵的特征值分解有何关系？为什么不直接求原矩阵的特征值分解呢？</p>
<ol type="1">
<li>伴随矩阵的特征值与原矩阵是一样的。</li>
<li>伴随矩阵的特征向量有一个符号差异。</li>
</ol>
<p><strong>RcppEigen</strong> 包封装了 Eigen 库，它在 <strong>RcppEigen</strong> 包的源码路径为</p>
<p><code>RcppEigen/inst/include/Eigen/src/Eigenvalues/SelfAdjointEigenSolver.h</code></p>
<p>在 Eigen 库的源码路径如下：</p>
<p><code>Eigen/src/Eigenvalues/SelfAdjointEigenSolver.h</code> 。</p>
<p>如何使用 <strong>RcppEigen</strong> 包加速计算？还是要看 Eigen 库的文档和源码，通过阅读源码，可以知道有哪些求解器，比如名称 <code>SelfAdjointEigenSolver</code> ，以及求解器包含的方法，比如 <code>eigenvalues()</code> 和 <code>eigenvectors()</code>，还有参数和返回值类型等。以特征值分解器 <code>SelfAdjointEigenSolver</code> 为例，编译上面的 C++ 代码，获得在 R 语言环境中可直接使用的函数 <code>getEigenValues()</code> 。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a><span class="co"># 编译代码</span></span>
<span id="cb126-2"><a href="#cb126-2"></a>Rcpp<span class="sc">::</span><span class="fu">sourceCpp</span>(<span class="at">file =</span> <span class="st">"code/rcpp_eigen.cpp"</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>然后，函数 <code>getEigenValues()</code> 计算特征值，返回一个向量。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1"></a><span class="co"># 计算特征值</span></span>
<span id="cb127-2"><a href="#cb127-2"></a><span class="fu">getEigenValues</span>(A)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4379501 3.5620499</code></pre>
</div>
</div>
<p>返回一个矩阵，列是特征向量。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1"></a><span class="co"># 计算特征向量</span></span>
<span id="cb129-2"><a href="#cb129-2"></a><span class="fu">getEigenVectors</span>(A)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]       [,2]
[1,] -0.9055894 -0.4241554
[2,]  0.4241554 -0.9055894</code></pre>
</div>
</div>
<p>根据上述分解结果计算矩阵 A 的伴随矩阵 <span class="math inline">\(A^{\star}\)</span> 。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1"></a><span class="fu">t</span>(<span class="fu">getEigenVectors</span>(A)) <span class="sc">%*%</span> <span class="fu">diag</span>(<span class="fu">getEigenValues</span>(A)) <span class="sc">%*%</span> <span class="fu">getEigenVectors</span>(A)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]  1.0 -1.2
[2,] -1.2  3.0</code></pre>
</div>
</div>
</section><section id="sec-matrix-linear-regression" class="level2" data-number="B.4"><h2 data-number="B.4" class="anchored" data-anchor-id="sec-matrix-linear-regression">
<span class="header-section-number">B.4</span> 应用</h2>
<p>以线性模型为例讲述一些初步的计算性能提升办法。回顾一下线性回归的矩阵表示。</p>
<p><span class="math display">\[
\begin{aligned}
&amp;\boldsymbol{y} = X\boldsymbol{\beta} + \boldsymbol{\epsilon} \\
&amp;\boldsymbol{\epsilon} \sim \mathrm{MVN}(\boldsymbol{0}, \sigma^2I)
\end{aligned}
\]</span></p>
<p>模型中 <span class="math inline">\(\boldsymbol{\beta}, \sigma^2\)</span> 是待估的参数，它们的最小二乘估计分别记为 <span class="math inline">\(\hat{\boldsymbol{\beta}},\hat{\sigma^2}\)</span> 。</p>
<p><span class="math display">\[
\begin{aligned}
\hat{\boldsymbol{\beta}} &amp;= (X^{\top}X)^{-1}X^{\top}\boldsymbol{y} \\
\hat{\sigma^2} &amp;= \frac{\boldsymbol{y}^{\top}(I - X(X^{\top}X)^{-1}X^{\top})\boldsymbol{y}}{n - \mathrm{rank}(X)}
\end{aligned}
\]</span></p>
<p>在获得参数的估计后，响应变量 <span class="math inline">\(\boldsymbol{y}\)</span> 的预测 <span class="math inline">\(\hat{\boldsymbol{y}}\)</span> 及其预测方差 <span class="math inline">\(\mathsf{Var}(\hat{\boldsymbol{y}})\)</span> 如下。</p>
<p><span class="math display">\[
\begin{aligned}
\hat{\boldsymbol{y}} &amp;= X(X^{\top}X)^{-1}X^{\top}\boldsymbol{y} \\
\mathsf{Var}(\hat{\boldsymbol{y}}) &amp; = \sigma^2 X(X^{\top}X)^{-1}X^{\top}
\end{aligned}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb133-2"><a href="#cb133-2"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb133-3"><a href="#cb133-3"></a>p <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb133-4"><a href="#cb133-4"></a>x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(n <span class="sc">*</span> p), n)</span>
<span id="cb133-5"><a href="#cb133-5"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb133-6"><a href="#cb133-6"></a>fit_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="dv">0</span>)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>下面不同的方法来计算预测值 <span class="math inline">\(\hat{\boldsymbol{y}}\)</span> ，从慢到快地优化。教科书版就是从左至右依次计算。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a>fit_base <span class="ot">=</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb134-2"><a href="#cb134-2"></a>  x <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">t</span>(x) <span class="sc">%*%</span> x) <span class="sc">%*%</span> <span class="fu">t</span>(x) <span class="sc">%*%</span> y</span>
<span id="cb134-3"><a href="#cb134-3"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>矩阵乘向量比矩阵乘矩阵快。虽然矩阵乘法没有交换律，但是有结合律。先向量计算，然后矩阵计算。</p>
<p><span class="math display">\[
\hat{\boldsymbol{y}} = X(X^{\top}X)^{-1}X^{\top}\boldsymbol{y}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1"></a>fit_vector <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb135-2"><a href="#cb135-2"></a>  x <span class="sc">%*%</span> (<span class="fu">solve</span>(<span class="fu">t</span>(x) <span class="sc">%*%</span> x) <span class="sc">%*%</span> (<span class="fu">t</span>(x) <span class="sc">%*%</span> y))</span>
<span id="cb135-3"><a href="#cb135-3"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>解线性方程组比求逆快。 <span class="math inline">\(X^{\top}X\)</span> 是对称的，通过解线性方程组来避免求逆。</p>
<p><span class="math display">\[
\hat{\boldsymbol{y}} = X(X^{\top}X)^{-1}X^{\top}\boldsymbol{y}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a>fit_inv <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb136-2"><a href="#cb136-2"></a>  x <span class="sc">%*%</span> <span class="fu">solve</span>(<span class="fu">crossprod</span>(x), <span class="fu">crossprod</span>(x, y))</span>
<span id="cb136-3"><a href="#cb136-3"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>QR 分解。 <span class="math inline">\(X_{n\times p} = Q_{n\times p} R_{p\times p}\)</span>，<span class="math inline">\(n &gt; p\)</span>，<span class="math inline">\(Q^{\top}Q = I\)</span>，<span class="math inline">\(R\)</span> 是上三角矩阵。</p>
<p><span class="math display">\[
\begin{aligned}
\hat{\boldsymbol{y}} &amp;= X(X^{\top}X)^{-1}X^{\top}\boldsymbol{y} \\
&amp; = QR \big((QR)^{\top}QR\big)^{-1}(QR)^{\top}\boldsymbol{y} \\
&amp; = QR(R^{\top}R)^{-1}R^{\top}Q^{\top}\boldsymbol{y} \\
&amp; = QQ^{\top}\boldsymbol{y}
\end{aligned}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1"></a>fit_qr <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb137-2"><a href="#cb137-2"></a>  decomp <span class="ot">&lt;-</span> <span class="fu">qr</span>(x)</span>
<span id="cb137-3"><a href="#cb137-3"></a>  <span class="fu">qr.qy</span>(decomp, <span class="fu">qr.qty</span>(decomp, y))</span>
<span id="cb137-4"><a href="#cb137-4"></a>}</span>
<span id="cb137-5"><a href="#cb137-5"></a>fit_qr2 <span class="ot">&lt;-</span> <span class="fu">lm.fit</span>(x, y)</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>其中，函数 <code>qr.qy(decomp, y)</code> 表示 <code>Q %*% y</code> ，函数 <code>qr.qty(decomp, y)</code> 表示 <code>t(Q) %*% y</code> 。实际上，Base R 提供的线性回归拟合函数 <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> 就采用 QR 分解。</p>
<p>Cholesky 分解。记 <span class="math inline">\(A = X^{\top}X\)</span> ，若 <span class="math inline">\(A\)</span> 是正定矩阵，则 <span class="math inline">\(A\)</span> 可做 Cholesky 分解。不妨设<span class="math inline">\(A = L^{\top}L\)</span>，其中 <span class="math inline">\(L\)</span> 是上三角矩阵。</p>
<p><span class="math display">\[
\begin{aligned}
\hat{\boldsymbol{y}} &amp;= X(X^{\top}X)^{-1}X^{\top}\boldsymbol{y} \\
&amp; = X\big(L^{\top}L\big)^{-1}X^{\top}\boldsymbol{y} \\
&amp; = XL^{-1}(L^{\top})^{-1}X^{\top}\boldsymbol{y}
\end{aligned}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a>fit_chol <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb138-2"><a href="#cb138-2"></a>  decomp <span class="ot">&lt;-</span> <span class="fu">chol</span>(<span class="fu">crossprod</span>(x))</span>
<span id="cb138-3"><a href="#cb138-3"></a>  lxy <span class="ot">&lt;-</span> <span class="fu">backsolve</span>(decomp, <span class="fu">crossprod</span>(x, y), <span class="at">transpose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb138-4"><a href="#cb138-4"></a>  b <span class="ot">&lt;-</span> <span class="fu">backsolve</span>(decomp, lxy)</span>
<span id="cb138-5"><a href="#cb138-5"></a>  x <span class="sc">%*%</span> b</span>
<span id="cb138-6"><a href="#cb138-6"></a>}</span></code><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>函数 <code><a href="https://rdrr.io/r/base/backsolve.html">backsolve()</a></code> 求解上三角线性方程组。</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Bates1988" class="csl-entry" role="listitem">
Bates, Douglas M., 和 Donald G. Watts. 1988. <em>Nonlinear Regression Analysis and Its Applications</em>. New York, NY: John Wiley &amp; Sons. <a href="https://doi.org/10.1002/9780470316757.app2">https://doi.org/10.1002/9780470316757.app2</a>.
</div>
<div id="ref-David1978" class="csl-entry" role="listitem">
Hoaglin, David C., 和 Roy E. Welsch. 1978. <span>《The Hat Matrix in Regression and ANOVA》</span>. <em>The American Statistician</em> 32 (1): 17–22. <a href="https://www.jstor.org/stable/2683469">https://www.jstor.org/stable/2683469</a>.
</div>
</div>
</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p><a href="https://stat.ethz.ch/pipermail/r-help/2006-March/101596.html" class="uri">https://stat.ethz.ch/pipermail/r-help/2006-March/101596.html</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "已复制");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "已复制");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><script src="https://giscus.app/client.js" data-repo="XiangyunHuang/data-analysis-in-action" data-repo-id="R_kgDOGTNtPQ" data-category="General" data-category-id="DIC_kwDOGTNtPc4CQjXN" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><input type="hidden" id="giscus-base-theme" value="light"><input type="hidden" id="giscus-alt-theme" value="dark"><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./notations.html" class="pagination-link  aria-label=">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">数学符号</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./git-github.html" class="pagination-link" aria-label="<span class='chapter-number'>C</span>&nbsp; <span class='chapter-title'>Git 和 Github</span>">
        <span class="nav-page-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Git 和 Github</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/XiangyunHuang/data-analysis-in-action/blob/main/matrix-operations.qmd" class="toc-action"><i class="bi bi-github"></i>查看代码</a></li></ul></div></div></div></footer></body></html>