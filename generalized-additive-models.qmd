# 广义可加模型 {#sec-generalized-additive-models}

```{r}
#| echo: false

source("_common.R")
```

广义可加模型是一种非线性模型

## 频率派

MASS 包的 mcycle 数据集

```{r}
#| label: fig-mcycle
#| fig-width: 4
#| fig-height: 3
#| fig-cap: mcycle 数据集
#| fig-showtext: true

data(mcycle, package = "MASS")
library(ggplot2)
ggplot(data = mcycle, aes(x = times, y = accel)) +
  geom_point() +
  theme_bw()
```

样条回归

```{r}
#| message: false

library(mgcv)
fgam <- gam(accel ~ s(times), data = mcycle, method = "REML")
summary(fgam)
```

方差成分

```{r}
gam.vcomp(fgam, rescale = FALSE)
```

```{r}
#| label: fig-mcycle-viz
#| fig-width: 4
#| fig-height: 4
#| fig-cap: mcycle 数据集
#| fig-showtext: true
#| par: true

plot(fgam)
```

## 贝叶斯派

```{r}
#| message: false

library(cmdstanr)
```

```{r}
#| eval: false

library(brms)
bgam <- brm(bf(accel ~ s(times)),
  data = mcycle, family = gaussian(), cores = 2, seed = 20232023,
  iter = 4000, warmup = 1000, thin = 10, refresh = 0,
  control = list(adapt_delta = 0.99)
)
summary(bgam)
```

```{r}
#| eval: false

ms_bgam <- marginal_smooths(bgam)
plot(ms_bgam)
```
